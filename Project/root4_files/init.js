var s=(function(window,undefined){var _console={log:[],warn:[],error:[]};if(Array.prototype['last']===undefined){Array.prototype.last=function(){if(this.length>0){return this[this.length-1];}}};if(!Array.prototype.filter){Array.prototype.filter=function(fun){if(typeof fun!="function"){throw new TypeError("Invalid Argument, Expected Function, got "+typeof fun);}
var len=this.length,res=new Array(),thisp=arguments[1];for(var i=0;i<len;i++){if(i in this){var val=this[i];if(fun.call(thisp,val,i,this)){res.push(val);}}}
return res;};};if(typeof Object.create!=='function'){Object.create=function(o){function F(){}
F.prototype=o;return new F();};};if(typeof Array.prototype.upsert!=='function'){Array.prototype.upsert=function(obj,key){if(key===undefined)return;for(i in this){if(this[i][key]==obj[key]){this[i]=$.extend({},this[i],obj);return;}}
this.push(obj);};};window['debug']=function(){var args=arguments;if(Array.prototype['slice']!==undefined){args=Array.prototype.slice.call(arguments,0);}else{for(var i in arguments){if(arguments.hasOwnProperty(i)&&typeof arguments[i]!=='function'){args.push(arguments[i]);}}}
var console_type='log';if(['warn','error','log'].indexOf(args.last())>-1){console_type=args.pop();};args=[(new Date().toUTCString())].concat(args);if(window['console']!==undefined){for(k in args){if(args.hasOwnProperty(k)){if(true){window['console'][console_type](args[k]);}else{_console[console_type].push(args[k]);}}}}else{_console[console_type]=_console[console_type].concat(args);}}
return{console:_console}})(window);function error(){args=Array.prototype.slice.call(arguments,0).concat(['error']);debug.call(args);};function isset(variable){return(typeof(window[variable])!=='undefined');}
function showError(error){/*if(error){alert(error);try{console.log(error);}catch(err){}}*/}
function checkTime(){var serverdate=false,clientdate=false;$.ajax({async:false,cache:false,type:'get',url:'/getajax/getTime/',success:function(time){if(time){serverdate=time;clientdate=new Date().getTime()/1000;}}});setGlobal('serverdate',serverdate);setGlobal('clientdate',clientdate);diff=Math.abs(clientdate-serverdate);if(diff>3600*2){return false;}
return true;}
$.plugin=function(name,object){$.fn[name]=function(options){var args=Array.prototype.slice.call(arguments,1);return this.each(function(){var instance=$.data(this,name);if(instance){instance[options].apply(instance,args);}else{instance=$.data(this,name,Object.create(object).init(options,this));}});}}
$.fn.scramble=function(op,options){if(typeof(op)==='object'){options=$.extend({},op);op='start';}
var endval=0,digits=2,decimal=2,length=700,interval=70,step=0;if(options){if(options.endval!==undefined){endval=new Number(options.endval);}
if(options.digits!==undefined){digits=parseInt(options.digits);}
if(options.decimal!==undefined){decimal=parseInt(options.decimal);}
if(options.length!==undefined){length=parseInt(options.length);}}
var $this=$(this);switch(op){case'step':return $this.each(function(){var step_num=parseInt($this.data('scramble.step'))||0;if((step_num*interval)<length){setTimeout(function(){var number=new Number(Math.random()*Math.pow(10,digits));if(decimal>0){number=number.toFixed(decimal);}else{number=Math.round(number);}
if(number.delimit){number=number.delimit();}
$this.data('scramble.step',++step_num).text(number).scramble('step',options);},interval);}else{var number=new Number(endval);if(decimal>0){number=number.toFixed(decimal);}else{number=Math.round(number);}
if(number.delimit){number=number.delimit();}
$this.text(number).data('scramble.step',0);}});break;case'start':return $this.scramble('step',options);default:break;}
return $this;};function getVar(var_name){return getGlobal(var_name);}
function setGlobal(key,value){try{if(REQUEST_DATA===undefined){throw(RM_Exception.GLOBAL_SPACE_UNDEFINED);}
if(REQUEST_DATA.hasOwnProperty(key)){error('setGlobal, overriding existing key '+key+': '+REQUEST_DATA[key]+' with '+value);}
REQUEST_DATA[key]=value;}catch(err){error('setGlobal:: error setting global value for key '+key+': '+err);}}
function getGlobal(key){try{if(REQUEST_DATA===undefined||!REQUEST_DATA.hasOwnProperty(key)){error('getGlobal::unable to get key '+key);return;}
return REQUEST_DATA[key];}catch(err){error('getGlobal:: global variable possibly undefined: '+err);}}
var Environment=(function(){var ENV_DEVELOPMENT='development';var ENV_TESTING='testing';var ENV_STAGING='staging';var ENV_PRODUCTION='production';return{isDevelopment:function(){return getGlobal('env')===ENV_DEVELOPMENT;},isTesting:function(){return getGlobal('env')===ENV_TESTING;},isStaging:function(){return getGlobal('env')===ENV_STAGING;},isProduction:function(){return getGlobal('env')===ENV_PRODUCTION;},getHost:function(){return getGlobal('host');}};})();var RM_Exception={VAR_NOT_FOUND:-1};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(value){for(var i=0;i<this.length;i++){if(this[i]==value)return i;}
return-1;};}
if(!Array.prototype.indexOfProp){Array.prototype.indexOfProp=function(key,value){for(var i=0,elem;elem=this[i];i++){if(elem[key]){if(typeof(value)=='number'&&parseInt(elem[key]==value)){return i;}else if(elem[key]==value){return i;}}}
return-1;};}
if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}
if(!String.prototype.addslashes){String.prototype.addslashes=function(){return this.replace(/\\/g,'\\\\').replace(/\'/g,'\\\'').replace(/\"/g,'\\"').replace(/\0/g,'\\0');}}
if(!String.prototype.camelToHyphen){String.prototype.camelToHyphen=function(){var search=new RegExp("[A-Z]","g");var matches=search.exec(this);if(matches){for(var i=0;i<matches.length;i++){return this.replace(matches[i],'-'+matches[i].toLowerCase());}}
return this;};}
if(!String.prototype.hyphenToCamel){String.prototype.hyphenToCamel=function(){var search=new RegExp("-[a-z]","g");var matches=search.exec(this);if(matches){for(var i=0;i<matches.length;i++){return this.replace(matches[i],matches[i].toUpperCase().substr(1));}}
return this;};}
if(!Number.prototype.delimit){Number.prototype.delimit=function(separator,chunk_size){if(separator===undefined){separator=',';}
if(chunk_size===undefined){chunk_size=3;}
var result=[];var num=this.valueOf();if(num<Math.pow(10,chunk_size)){return''+num;}
var n='';n+=num;narr=n.split('');while(narr.length>0){var x=(narr.length%chunk_size>0)?narr.length%chunk_size:chunk_size;result.push(narr.splice(0,x).join(''));}
return result.join(separator);}}
var LoginService=(function(){debug('INITIALIZING LOGIN SERVICE');var _callbacks={success:[],error:[]};if(!Environment.isDevelopment()){$(function(){try{debug('initializing FB library, appId = '+getGlobal('fbKey'));FB.init({appId:getGlobal('fbKey'),status:true,cookie:true,xfbml:true,channelUrl:Environment.getHost()+'/channel.html'});debug('subscribing to logout...');FB.Event.subscribe('auth.logout',function(response){checkValidLogout();});debug('logout event subscribed.');}catch(err){debug("FB::auth.logout init, error calling FB library: "+err);showError("We couldn't establish a connection to Facebook for verifying your account, please try reloading the page."+err);}});}
var runSuccessCallbacks=function(){var success_handler;for(var i=0;i<_callbacks.success.length;i++){success_handler=_callbacks.success[i];success_handler.callback.call(document,success_handler.args);}};var runErrorCallbacks=function(){var error_handler;for(var i=0;i<_callbacks.error.length;i++){error_handler=_callbacks.error[i];error_handler.callback.call(document,error_handler.args);}};var doLogin=function(){if(Environment.isDevelopment()){runSuccessCallbacks();}else{var loggedIn=false;debug('LoginService::doLogin, not on development, checking FB session...');try{FB.getLoginStatus(function(response){debug('LoginService::doLogin, got FB session callback, making sure user time ok...');if(checkTime()){debug('LoginService::doLogin, user time is OK, checking FB session response...');if(response.session){debug('LoginService::doLogin, user is logged in!');return runSuccessCallbacks();}else{debug('LoginService::doLogin, no session response, bringing up login...');FB.login(function(response){if(response.session){return runSuccessCallbacks();}else{return runErrorCallbacks();}},{});}}else{showError("The time on your computer's clock is not what we expected.\nAre you sure it's set to the current date and time?\n\nPlease correct this and restart your browser to avoid any login troubles :)");return runErrorCallbacks();}});}catch(err){showError("We couldn't establish a connection to Facebook for verifying your account, please try again...");return runErrorCallbacks();}}};var checkValidLogout=function(){debug('Checking for valid FB logout...');try{FB.getLoginStatus(function(response){debug('checking valid session...');if(response.session){debug('valid session found!');return false;}
debug('logging out...');doLogout();});}catch(err){debug("LoginService::checkValidLogout, error calling FB library: "+err);}};var doLogout=function(){showError("You have been logged out. If you did not log out of Facebook, you probably have third-party cookies disabled.\n\nPlease enable third party cookies in your web browser in order for "+getGlobal('vendor')+" to be able to communicate with Facebook.");window.location="/logout";};return{addLoginCallback:function(callback,args,type){var _type='success';if(type!==undefined){_type=type;}
_callbacks[_type].push({callback:callback,args:args});},login:function(){debug('LoginService::login, trying login...');doLogin();}};})();$(function(){debug('initializing ready-hooks');LoginService.addLoginCallback(function(){window.location='/edit';});});$(function(){debug('common/header:: init');$("#logout-button").css({height:0,paddingTop:0,paddingBottom:0}).bind('click',function(){logoutAndRedirect();return false;});$("#user-login").bind('mouseenter',function(event){$(event.currentTarget).data("hovering",true);setTimeout(function(){if($(event.currentTarget).data("hovering"))$("#logout-button").stop().animate({height:'1em',paddingTop:'8px',paddingBottom:'8px'},250);},500);}).bind('mouseleave',function(event){var login_pane=$(event.currentTarget);login_pane.data("hovering",false);setTimeout(function(){if(!login_pane.data("hovering"))$("#logout-button").stop().animate({height:0,paddingTop:0,paddingBottom:0},250);},500);});});function logoutAndRedirect(){if(Environment.isDevelopment()){window.location="/logout";}else{if(confirm('This will log you out from both Facebook and '+getGlobal('vendor')+'.')){FB.logout(function(response){window.location="/logout";});}}
return false;}
$(function(){debug('templates/common: init');$('.hidden').hide().removeClass('hidden');$('a.help').live('click',function(event){var msg=$(event.currentTarget).siblings('.help-message');var offset=msg.hasClass('right')?($(event.currentTarget).position().left-215):($(event.currentTarget).position().left-100);var offsetY=msg.hasClass('right')?($(event.currentTarget).position().top+30):0;msg.css({left:offset+'px',top:offsetY+'px'});msg.slideToggle();return false;});$('.help-message').live('click',function(event){var msg=$(event.currentTarget);if(!msg.is(':hidden')){msg.slideUp();}
return false;});$('.help-message > p > a').live('click',function(event){var msg=$(event.currentTarget);msg.preventDefault();});$(document).click(function(event){$(event.currentTarget).find('.help-message').slideUp();});$('.hover-tip').live('mouseover mouseout mousemove',function(event){switch(event.type){case'mouseover':$(event.currentTarget).data('hovering',true);var helpWindow=$(event.currentTarget).siblings('.hover-tip-window');helpWindow.css({top:(event.clientY+15)+'px',left:(event.clientX+15)+'px'});setTimeout(function(){if($(event.currentTarget).data('hovering')){helpWindow.fadeIn('fast');}},350);break;case'mouseout':$(event.currentTarget).data('hovering',false);var helpWindow=$(event.currentTarget).siblings('.hover-tip-window');helpWindow.fadeOut('fast');break;case'mousemove':var helpWindow=$(event.currentTarget).siblings('.hover-tip-window');helpWindow.css({top:(event.clientY+15)+'px',left:(event.clientX+15)+'px'});break;default:break;}});$('.rm-collapsable').each(function(){var collapsableContainer=$(this);var collapsedContent=collapsableContainer.children('.rm-collapsable-content');if(collapsableContainer.hasClass('collapsed')){collapsedContent.hide();}
var collapsableControl=collapsableContainer.find('.rm-collapsable-control').first();collapsableControl.bind('click',function(event){if(collapsableContainer.hasClass('collapsed')){collapsedContent.slideDown();collapsableContainer.removeClass('collapsed');}else{collapsedContent.slideUp();collapsableContainer.addClass('collapsed');}});});if(!Environment.isDevelopment()){var host=getGlobal('host');loadFanbox(host);var ga=getGlobal('ga');loadGoogleAnalytics();loadChartbeat();}});function loadGoogleAnalytics(){var e=document.createElement('script');e.setAttribute('language','javascript');e.setAttribute('type','text/javascript');e.setAttribute('async','true');e.setAttribute('src',(('https:'==document.location.protocol)?'https://ssl':'http://www')+'.google-analytics.com/ga.js');document.body.appendChild(e);}
function loadChartbeat(){window._sf_endpt=(new Date()).getTime();var e=document.createElement('script');e.setAttribute('language','javascript');e.setAttribute('type','text/javascript');e.setAttribute('async','true');e.setAttribute('src',(("https:"==document.location.protocol)?"https://s3.amazonaws.com/":"http://")+"static.chartbeat.com/js/chartbeat.js");document.body.appendChild(e);}
function loadFanbox(host){try{var domTarget=document.getElementById("like-box");FB.XFBML.parse(domTarget);}catch(err){}}
$(function(){debug('widget/appearance:: init');var rmPageId=getGlobal('pageId');Saver.addSaveRule('rm-appearance-style','saveStyles.php',{rmPageId:rmPageId,styles:':param.css',index:':param.seq'});Saver.addSaveRule('banner-height','/saveAjax/saveBannerHeight/',{rmPageId:rmPageId,height:':param'});Saver.addSaveRule('disable-multi-banners','/rest/style',{rmPageId:rmPageId},'PUT');Saver.addSaveRule('style-create','/rest/style',{rmPageId:rmPageId,element:':param.element',style:':param.style',attributes:':param.attributes',image:':param.image',seq:':param.seq'},'POST');Saver.addSaveRule('style-update','/rest/style',{rmPageId:rmPageId,element:':param.element',style:':param.style'},'PUT');Saver.addSaveRule('style-reset','/rest/style',{op:'reset',rmPageId:rmPageId},'PUT');Saver.addSaveRule('style-reorder','/rest/style',{op:'reorder',rmPageId:rmPageId,element:':param.element',oldPosition:':param.oldPosition',newPosition:':param.newPosition'},'PUT');Saver.addSaveRule('style-delete','/rest/style',{rmPageId:rmPageId,element:':param.element',index:':param.index'},'DELETE');var cssEditor=new CSSEditWidget();$("#rm-content-launch").attr('href','#launch-content').bind('click',{controller:this},function(e){$(e.currentTarget).siblings().removeClass("active").end().addClass("active");RMUIWidgetRelay.relayEvent(RMUIEvent.EDITOR_MODE_CHANGE,'content');return false;});$('#rm-css-launch').removeClass('disabled').attr('href','#launch-css').bind('click',function(event){$(event.currentTarget).siblings().removeClass('active').end().addClass('active');RMUIWidgetRelay.relayEvent(RMUIEvent.EDITOR_MODE_CHANGE,'css');return false;});});$(function(){debug('widget/date_schedule:: init');var bandId=getGlobal('pageId');var ms_per_day=(1000*60*60*24);var today=Math.floor((new Date()).getTime()/ms_per_day)*ms_per_day;Saver.addSaveRule('show-add','/saveajax/addShow',{bandId:bandId,date:today,name:':param.name',price:':param.price',venueName:':param.venue',city:':param.city'});Saver.addSaveRule('show-remove','/saveajax/removeShow',{bandId:bandId,showId:':param'});Saver.addSaveRule('show-date','/saveajax/updateShowDate',{bandId:bandId,showId:':param.showId',date:':param.date'});Saver.addSaveRule('show-city','/saveajax/updateShowCity',{bandId:bandId,showId:':param.showId',city:':param.value'});Saver.addSaveRule('show-venue','/saveajax/updateShowVenue',{bandId:bandId,showId:':param.showId',venueName:':param.value'});Saver.addSaveRule('show-venue-sonicliving','/saveajax/updateShowVenue',{bandId:bandId,showId:':param.showId',venueName:':param.venueName',sonicLivingId:':param.sonicLivingId',address:':param.address',phone:':param.phone',latitude:':param.latitude',longitude:':param.longitude',location:':param.location'});Saver.addSaveRule('show-supporting','/saveajax/updateShowSupportingAct',{bandId:bandId,showId:':param.showId',bands:':param.value'});Saver.addSaveRule('show-price','/saveajax/updateShowPrice',{bandId:bandId,showId:':param.showId',price:':param.value'});Saver.addSaveRule('show-purchase-url','/saveajax/updateShowPurchaseUrl',{bandId:bandId,showId:':param.showId',purchaseUrl:':param.value'});Saver.addSaveRule('artistdata-key','/saveajax/getArtistDataKey',{bandId:bandId});var artist_data_modal=new ModalUtility($('#editor-pane-container'),true);$('#action-artistdata-connect').bind('click',function(event){if(!artist_data_modal.hasContent()){artist_data_modal.showDialog($('#artistdata-setup-modal').show().detach(),function(){$('#action-generate-key').one('click',function(event){debug('generating AD key...');var generateButton=$(event.currentTarget);generateButton.addClass('loading');Saver.save('artistdata-key','',{success:function(data){var key=data.artistDataBandKey;debug('fading out button!');generateButton.fadeOut('fast',function(){$(this).after('<p class="key-display">Your key is <strong>'+key+'</strong></p>');$(this).remove();});RMUIWidgetRelay.relayEvent('artistdata-connect',key);}});});});}else{artist_data_modal.showDialog();}
return false;});var _toursched=new TouringScheduleWidget($('#rm-tour-sched'),{date:today,prompts:{'show-date':'When\'s the gig?','show-venue':'Venue name','show-city':'City','show-supporting':'Enter opening / supporting acts','show-price':'TBA'}});});$(function(){debug('widget/drop_down_pane:: init');var _context=$('#editor-main-hover-layer');var rmPageId=getGlobal('fanPageId');var bandId=getGlobal('pageId');Saver.addSaveRule('genreGroup','/saveajax/saveGenreGroup/',{bandId:bandId,mainGenre:':param.main',subGenre:':param.sub',group:':param.group'});Saver.addSaveRule('genreCustom','/saveajax/saveCustomGenre/',{bandId:bandId,customGenre:':param'});Saver.addSaveRule($('#genreOn').attr('name'),'/saveajax/setShowGenre/',{rmPageId:rmPageId,show:':param'});Saver.addSaveRule($('#messageOn').attr('name'),'/saveajax/setShowMessage/',{rmPageId:rmPageId,show:':param'});Saver.addSaveRule($('#emailOn').attr('name'),'/saveajax/setShowEmail/',{rmPageId:rmPageId,show:':param'});Saver.addSaveRule($('#phoneOn').attr('name'),'/saveajax/setShowPhone/',{rmPageId:rmPageId,show:':param'});Saver.addSaveRule('phone','/saveajax/saveBandPhone/',{bandId:bandId,phone:':param'});Saver.addSaveRule('bio','/saveajax/saveBio/',{rmPageId:rmPageId,bio:':param'});Saver.addSaveRule('website','/saveajax/updateBandWebsite/',{bandId:bandId,websiteId:':param.id',title:':param.websiteTitle',url:':param.websiteUrl'});Saver.addSaveRule('website-remove','/saveajax/removeBandWebsite/',{bandId:bandId,websiteId:':param'});Saver.addSaveRule('website-add','/saveajax/addBandWebsite/',{bandId:bandId,title:':param.websiteTitle',url:':param.websiteUrl'});Saver.addSaveRule('email','/saveajax/updateBandEmail/',{bandId:bandId,emailId:':param.id',title:':param.emailTitle',email:':param.emailAddress'});Saver.addSaveRule('email-remove','/saveajax/removeBandEmail/',{bandId:bandId,emailId:':param'});Saver.addSaveRule('email-add','/saveajax/addBandEmail/',{bandId:bandId,title:':param.emailTitle',email:':param.emailAddress'});Saver.addSaveRule('open-more-info','/saveajax/updateOpenMoreInfo/',{fanPageId:rmPageId,openMoreInfo:':param'});var $pin_dock=$('.pin-dock',_context);$pin_dock.find('.pin-toggle').bind('click',function(event){var input=$('input[name="open-more-info"]',_context)[0];input.checked=!input.checked;var $pin=$('.pin-icon',event.currentTarget),$notification=$('.notification',$(event.currentTarget).closest('.pin-dock'));var pos=$pin.show().position();if(input.checked){$pin.css({opacity:0,top:(pos.top-15)+'px',left:(pos.left+5)+'px'}).animate({opacity:1,top:pos.top+'px',left:pos.left+'px'},250);$notification.text('Cool! Your "More Info" pane will now be open by default.').stop().fadeIn(250).delay(1500).fadeOut();}else{$pin.animate({opacity:0,top:'-=15px',left:'+=5px'},250,function(){$(this).css({opacity:'',top:pos.top+'px',left:pos.left+'px'}).hide();});$notification.text('Your "More Info" pane is now closed by default.').stop().fadeIn(250).delay(1500).fadeOut();}
$(input).change();return false;});$('input[name="open-more-info"]',_context).bind('change',function(event){var open_more_info=this.checked;Saver.save($(this).attr('name'),open_more_info);});var genreEditor=new GenreSevenWidget($('#rm-genre-seven-widget',_context),{});$('#genreOn').bind('change',function(event){var show=$('#genreOn:checked').val();if(show!=undefined){show="true";}else{show="false";}
Saver.save($(event.currentTarget).attr('name'),show);});var emailEditor=new MultivalWidget($('.rm-multival[name="emails"]',_context),{autoAdd:true,validate:'email'});$('#emailOn').bind('change',function(event){var show=$('#emailOn:checked').val();if(show!=undefined){show="true";}else{show="false";}
Saver.save($(event.currentTarget).attr('name'),show);var emailInput=emailEditor._domTarget;if(emailInput.is(':hidden')){emailInput.slideDown();}else{emailInput.slideUp();}});$('#messageOn').bind('change',function(event){var show=$('#messageOn:checked').val();if(show!=undefined){show="true";}else{show="false";}
Saver.save($(event.currentTarget).attr('name'),show);});var phoneEditor=new TextInlineEditWidget($('.rm-inline-edit[name="phone"]',_context),{prompt:'not set'});$('#phoneOn').bind('change',function(event){var show=$('#phoneOn:checked').val();if(show!=undefined){show="true";}else{show="false";}
Saver.save($(event.currentTarget).attr('name'),show);var phoneInput=phoneEditor._domTarget;if(phoneInput.is(':hidden')){phoneInput.slideDown();}else{phoneInput.slideUp();}});var websiteEditor=new MultivalWidget($('.rm-multival[name="websites"]',_context),{autoAdd:true,validate:'url'});var bioEditor=new TextInlineEditWidget($('.rm-inline-edit[name="bio"]',_context));var showDropDown=function(){$('#editor-main-info').show().siblings().hide();$('#editor-more-info-button').addClass('active');$('#editor-main-hover-layer').slideDown('fast',function(){if(editor_mode!=='css'){$('.pin-dock',this).fadeIn();}}).click(function(e){e.stopPropagation();});};var hideDropDown=function(){$('#editor-main-hover-layer').slideUp('fast',function(){$('#editor-main-info').hide();$('#editor-more-info-button').removeClass('active');$('.pin-dock',this).hide();});};var toggleDropDownDisplay=function(event){if($('#editor-main-info').is(':hidden')){showDropDown();}else{hideDropDown();}
event.stopPropagation();return false;};$('#editor-more-info-button, #editor-hover-close-button').bind('click',toggleDropDownDisplay);var editor_mode='content';RMUIWidgetRelay.addCallback(RMUIEvent.EDITOR_MODE_CHANGE,null,function(mode){switch(mode){case'css':if($('#editor-main-info').is(':hidden')){showDropDown();}
$('#editor-hover-close-button').unbind('click');$pin_dock.hide();break;case'content':$('#editor-hover-close-button').bind('click',toggleDropDownDisplay);if($('#editor-main-info').is(':visible')){$pin_dock.fadeIn();}
break;default:break;}
editor_mode=mode;});});$(function(){debug('widget/media_player:: init');var bandId=getGlobal('pageId');Saver.addSaveRule('playlist-update-order','/saveajax/updateTrackOrder',{bandId:bandId,trackIds:':param'});Saver.addSaveRule('track-add','/saveajax/addTrackToPlaylist',{bandId:bandId,sourceType:':param.sourceType',sourceId:':param.sourceId',title:':param.title',description:':param.description',duration:':param.duration',artworkUrl:':param.artworkUrl',downloadable:':param.downloadable',purchasable:':param.purchasable',purchaseUrl:':param.purchaseUrl',streamUrl:':param.streamUrl'});Saver.addSaveRule('track-update','/saveajax/updateTrack',{bandId:bandId,trackId:':param.trackId',title:':param.title',description:':param.description',artworkUrl:':param.artworkUrl',purchaseUrl:':param.purchaseUrl',downloadable:':param.downloadable',purchasable:':param.purchasable'});Saver.addSaveRule('track-remove','/saveajax/removeTrackFromPlaylist',{bandId:bandId,trackId:':param'});var rmPlayerSecondaryColor=$('#editor-pane-container .rmplayer-secondary-ui').css('background-color');$('#rmplayer-playbutton .rmplayer-icon').css({backgroundColor:'transparent'}).svg(function(thisSvg){thisSvg.polygon([[6.43,2.656],[18.57,12],[6.43,21.344]],{fill:rmPlayerSecondaryColor});});$('#rmplayer-volume .rmplayer-icon').css({backgroundColor:'transparent'}).svg(function(thisSvg){thisSvg.polygon([[20,0],[9.796,3.571],[9.796,16.429],[20,20]],{fill:rmPlayerSecondaryColor});thisSvg.rect(0,6.429,7.755,7.143,{fill:rmPlayerSecondaryColor});});var scConnect=getGlobal('scConnect');var _trackManager=new TrackManagerWidget($('#rm-track-manager'),{scConnect:scConnect});});$(function(){debug('widget/nav_bar:: init');var modal_photo=new ModalUtility('#editor-pane-container');var modal_video=new ModalUtility('#editor-pane-container',true);var handleButtons=function(event){var id=$(event.currentTarget).attr('id');switch(id){case'editor-photo-button':if(!modal_photo.hasContent()){modal_photo.showDialog($('#rm-photos').show().detach());}else{modal_photo.showDialog();}
break;case'editor-video-button':if(!modal_video.hasContent()){modal_video.showDialog($('#rm-videos').show().detach());}else{modal_video.showDialog();}
RMUIWidgetRelay.relayEvent('video-pane-activate');break;default:break;}
return false;};var handleModeChange=function(mode){debug('handling mode change...');switch(mode){case'css':$('#editor-photo-button, #editor-video-button').unbind('click');break;case'content':$('#editor-photo-button, #editor-video-button').bind('click',handleButtons);break;default:break;}};RMUIWidgetRelay.addCallback(RMUIEvent.EDITOR_MODE_CHANGE,this,handleModeChange);$('#editor-photo-button, #editor-video-button').bind('click',handleButtons);});$(function(){var rmPageId=getGlobal('fanPageId');var title=$('#editor-page-title > h3');if(title.length){var title_editor=new TextInlineEditWidget(title);Saver.addSaveRule(title.attr('name'),'/saveajax/saveTitle/',{title:':param',rmPageId:rmPageId});}
var location=$('#editor-page-location');if(location.length){var location_editor=new TextInlineEditWidget(location);Saver.addSaveRule(location.attr('name'),'/saveajax/saveLocation/',{location:':param',rmPageId:rmPageId});}});$(function(){var bandId=getGlobal('pageId');Saver.addSaveRule('add-video-vimeo','/saveajax/saveVimeo/',{bandId:bandId,link:':param'});Saver.addSaveRule('add-video-youtube','/saveajax/saveYoutube/',{bandId:bandId,link:':param'});Saver.addSaveRule('remove-video','/saveajax/removeVideo/',{bandId:bandId,videoId:':param'});var video_editors=new Array();$('.rm-video-edit','#rm-videos').each(function(){var options={type:false};if($(this).hasClass('youtube')){options.type='youtube';}else if($(this).hasClass('vimeo')){options.type='vimeo';}
video_editors.push(new VideoEditWidget($(this),options));});var _gotVideos=false;var getFbVideos=function(){if(_gotVideos){return false;}
var fbVideoDOM=$('#fb-videos');$('.loading',fbVideoDOM.selector+' .fb-status').siblings().hide().end().fadeIn();$.ajax({type:'post',url:'/getajax/getFbVideos',dataType:'json',data:{fbPageId:getGlobal('fbPageId')},success:function(data,response){if(!data||data.status<0){$('.empty',fbVideoDOM.selector+' .fb-status').siblings().hide().end().fadeIn();return false;}
if(data.videos.length<1){$('.empty',fbVideoDOM.selector+' .fb-status').siblings().hide().end().fadeIn();return false;}
debug(data);$('.not-empty',fbVideoDOM.selector+' .fb-status').siblings().hide().end().fadeIn();$('.not-empty',fbVideoDOM.selector+' .fb-status').children('.video-count-display').text(data.videos.length+' videos');var dom_template=$('.template',fbVideoDOM.selector+' .video-items').get(0);debug(dom_template);$.each(data.videos,function(indx,vid){var chk_exists=$('li[rel="'+vid.vid+'"]',fbVideoDOM);debug('Checking if this FB video exists: '+chk_exists.length);if(!chk_exists.length){var fb_video_dom=$(dom_template.cloneNode(true));$('.title',fb_video_dom).text(vid.title);$('.video-thumb',fb_video_dom).attr('src',vid.image).attr('alt',vid.title);fb_video_dom.attr('rel',vid.vid);fb_video_dom.appendTo($('.video-items',fbVideoDOM)).show();}});return true;},error:function(err){}});};RMUIWidgetRelay.addCallback('video-pane-activate',this,getFbVideos);});$(function(){debug('common/header/nav:: init.');var loading_graphic=$(new Image()).attr('src','http://b.ak.static-rootmusic.com/images/common/ajax-loader-trans.gif?v=2.70').attr('id','loading_graphic');loading_graphic.css({display:'inline-block',marginLeft:'0.5em'});$('#mainnav-sign-in').bind('click',function(event){$(event.currentTarget).css({color:'#666',background:'transparent'}).text('loading').append(loading_graphic);LoginService.login();return false;});});$(function(){var modal_facebook=new ModalUtility('#editor-pane-container',true);$('#fb-instructions-button').bind('click',function(event){if(modal_facebook.hasContent()){modal_facebook.showDialog();}else{modal_facebook.showDialog($('#rm-fb-instructions').show().detach());}
$('#autoshare-activate-button').data('fbPageId',$('#autoshare-fbPageId').val()).data('rmPageId',$('#autoshare-rmPageId').val());RMFBAutoshare.init($('#autoshare-activate-button'));event.stopImmediatePropagation();return false;});$('.fb-nav-step','#rm-fb-instructions').bind('click',function(event){var idTokens=$(event.currentTarget).attr('id').split('-');var id=idTokens[idTokens.length-1];if($('#fb-install-step-'+id).is(':hidden')){$('.fb-nav-step','#rm-fb-instructions').removeClass('active');$(event.currentTarget).addClass('active');$('#fb-install-step-'+id).siblings().hide().end().fadeIn();}
return false;});$('.fb-install-next-link','#rm-fb-instructions').bind('click',function(event){var hrefTokens=$(event.currentTarget).attr('href').split('-');var id=hrefTokens[hrefTokens.length-1];if($('#fb-install-step-'+id).is(':hidden')){$('.fb-nav-step','#rm-fb-instructions').removeClass('active');$('#fb-nav-step-'+id).addClass('active');$('#fb-install-step-'+id).siblings().hide().end().fadeIn();}
return false;});});$(function(){$('#fb-sidebar-overlay').bind('mouseenter mouseleave',function(event){var message=$('#fb-sidebar-description');var shade=$('#fb-sidebar-shade');switch(event.type){case'mouseenter':shade.stop().animate({opacity:0.75},250);message.fadeIn('fast');break;case'mouseleave':shade.stop().animate({opacity:0.2},250);message.fadeOut('fast');break;default:break;}});});$(function(){var _context='#editor-footer';var rmPageId=getGlobal('fanPageId');var twitter_widget=false;var twitter_list_widget=false;var rss_widget=false;$('.rm-inline-edit',_context).each(function(){var widget=new TextInlineEditWidget($(this));switch($(this).attr('name')){case'twitter':widget.addCallback('update',FeedLivePreview,FeedLivePreview.updateTwitterUI);twitter_widget=widget;break;case'twitterList':widget.addCallback('update',FeedLivePreview,FeedLivePreview.updateTwitterListUI);twitter_list_widget=widget;break;case'rssFeed':widget.addCallback('update',FeedLivePreview,FeedLivePreview.updateRSSUI);rss_widget=widget;break;default:break;}});FeedLivePreview.init({twitter_username:twitter_widget,twitter_listname:twitter_list_widget,rss_feed_url:rss_widget});Saver.addSaveRule($('#edit-wall-filter').attr('name'),'/saveajax/saveWallFilter/',{wallFilter:':param',rmPageId:rmPageId});Saver.addSaveRule($('#rm-edit-twitter').attr('name'),'/saveajax/saveTwitter/',{twitter:':param',rmPageId:rmPageId});Saver.addSaveRule($('#rm-edit-twitter-list').attr('name'),'/saveajax/saveTwitterList/',{twitterList:':param',rmPageId:rmPageId});Saver.addSaveRule($('#rm-edit-feed').attr('name'),'/saveajax/saveRssFeed/',{rssFeed:':param',rmPageId:rmPageId});Saver.addSaveRule($('#rm-edit-feed-title').attr('name'),'/saveajax/saveRssTitle/',{rssTitle:':param',rmPageId:rmPageId});Saver.addSaveRule('set-default-feed','/saveajax/setDefaultFeed/',{fanPageId:rmPageId,feedIdentifier:':param'})
$('#edit-wall-filter').bind('change',function(event){Saver.save($(event.currentTarget).attr('name'),$(event.currentTarget).val());});var updateFeedView=function(event){var feed_type=$(event.currentTarget).attr('id').split('-').shift();if(FeedWidget.supports(feed_type)){FeedWidget.setCurrentFeed(feed_type);switch(feed_type){case'twitter':FeedLivePreview.updateTwitterUI();break;case'rss':FeedLivePreview.updateRSSUI();break;}
DefaultFeedToggler.setFeedView(feed_type);}
return false;};$('#wall-show, #twitter-show, #rss-show').bind('click',updateFeedView);var DefaultFeedToggler=function(){var $dock=$('.pin-dock',_context);var $pin=$dock.find('.pin-icon');var $notification=$dock.find('.notification');var $input=$('input[name="set-default-feed"]',_context);var _default_feed=getGlobal('default_feed_type');$dock.bind('click',function(event){if(_default_feed===FeedWidget.getCurrentFeed()&&_default_feed===FeedWidget.FEED_TYPE_FACEBOOK){showMessage('Click me when on "Twitter" or "RSS" to switch the default Feed view!');return false;}
var input=$input[0];input.checked=!input.checked;var initial_feed=_default_feed;if(input.checked){_default_feed=FeedWidget.getCurrentFeed();showMessage('Cool! This Feed will now be open by default.');}else{_default_feed=FeedWidget.FEED_TYPE_FACEBOOK;showMessage('Your Wall will now be the default Feed.');}
$input.change();updatePinStatus();return false;});$input.bind('change',function(event){var $this=$(this);if(!_default_feed){debug('Saving new default feed: invalid feed type given! type = "'+_default_feed+'"');return false;}
Saver.save($this.attr('name'),_default_feed);return false;});var showMessage=function(message){$notification.text(message).stop().fadeIn(250).delay(1500).fadeOut();};var updatePinStatus=function(){if(_default_feed===FeedWidget.getCurrentFeed()){$input[0].checked=true;attachPin();}else{$input[0].checked=false;detachPin();}};var attachPin=function(){if($pin.is(':hidden')){var pos=$pin.show().position();$pin.css({opacity:0,top:(pos.top-15)+'px',left:(pos.left+5)+'px'}).animate({opacity:1,top:pos.top+'px',left:pos.left+'px'},250);}};var detachPin=function(){if($pin.is(':visible')){var pos=$pin.show().position();$pin.animate({opacity:0,top:'-=15px',left:'+=5px'},250,function(){$(this).css({opacity:'',top:pos.top+'px',left:pos.left+'px'}).hide();});}};return{show:function(){$dock.fadeIn();},hide:function(){$dock.fadeOut();},setFeedView:function(feed_type){updatePinStatus(feed_type);}};}();DefaultFeedToggler.show();RMUIWidgetRelay.addCallback(RMUIEvent.EDITOR_MODE_CHANGE,null,function(mode){switch(mode){case'css':$('#wall-show, #twitter-show, #rss-show').unbind('click').removeAttr('href');FeedWidget.close();DefaultFeedToggler.hide();break;case'content':$('#wall-show, #twitter-show, #rss-show').bind('click',updateFeedView).attr('href','#open-tab');FeedWidget.open();DefaultFeedToggler.show();break;default:break;}});});var FeedLivePreview=(function(){var twitter_username=false;var twitter_listname=false;var rss_feed_url=false;return{init:function(options){if(options.hasOwnProperty('twitter_username')){twitter_username=options.twitter_username;}
if(options.hasOwnProperty('twitter_listname')){twitter_listname=options.twitter_listname;}
if(options.hasOwnProperty('rss_feed_url')){rss_feed_url=options.rss_feed_url;}},updateTwitterUI:function(){if(twitter_listname&&!twitter_listname._empty){if(twitter_listname._empty&&$('#twitter-feed-extra').is(':visible')){$('#twitter-feed-extra').fadeOut('fast');}
return false;}
if(!twitter_username._empty&&$('#twitter-feed-extra').is(':hidden')){$('#twitter-feed-extra').fadeIn('fast');$('#twitter-preview').fadeIn('fast');}else if(twitter_username._empty&&$('#twitter-feed-extra').is(':visible')){$('#twitter-feed-extra').fadeOut('fast');$('#twitter-preview').fadeIn('fast');}
$('#twitter-preview').html('').hide();$('#twitter-preview-loading').show();var url='/getajax/getTwitterPreview/';var params={twitterName:twitter_username.getValue()};if(!twitter_username._empty){$.ajax({url:url,type:'post',data:params,dataType:'json',success:function(json,response){$('#twitter-preview-loading').hide();if(json.status>=0){$('#twitter-preview').html(json.html).fadeIn('fast').show();}else{$('#twitter-preview').html('');debug('FeedWidget::updateTwitterUI: an error occurred: '+json.error);}}});}},updateTwitterListUI:function(){$('#twitter-preview').html('').hide();$('#twitter-preview-loading').show();var twitter=twitter_username.getValue();var twitterListName=twitter_listname.getValue();if(twitterListName){url='/getajax/getTwitterListPreview/';params={twitterName:twitter,twitterList:twitterListName};}else{url='/getajax/getTwitterPreview/';params={twitterName:twitter};}
if(twitter||twitterListName){$.ajax({url:url,type:'post',data:params,dataType:'json',success:function(json,response){$('#twitter-preview-loading').hide();if(json.status>=0){$('#twitter-preview').html(json.html).fadeIn('fast').show();}else{$('#twitter-preview').html("");debug('FeedWidget::updateTwitterListUI: an error occurred: '+json.error);}}});}},updateRSSUI:function(){if(!rss_feed_url._empty&&$('#rss-feed-extra').is(':hidden')){$('#rss-feed-extra').fadeIn('fast');$('#rss-preview').fadeIn('fast');}else if(rss_feed_url._empty&&$('#rss-feed-extra').is(':visible')){$('#rss-feed-extra').fadeOut('fast');$('#rss-preview').fadeOut('fast');}
$('#rss-preview').html('');if(!rss_feed_url._empty){$('#rss-preview-loading').show();$.ajax({url:'/getajax/getRSSPreview/',type:'post',data:{feedUrl:rss_feed_url.getValue()},dataType:'json',success:function(json,response){$('#rss-preview-loading').hide();if(json.status>=0){$('#rss-preview').html(json.html).show();}else{$('#rss-preview').html('');debug('FeedWidget::updateRSSUI: an error occurred: '+json.error);}}});}}};})();var FeedWidget=(function(){var FEED_TYPE_FACEBOOK='wall';var FEED_TYPE_TWITTER='twitter';var FEED_TYPE_RSS='rss';var _current_feed=FEED_TYPE_FACEBOOK;var showMediaPane=function(which){if(which===undefined){which=FEED_TYPE_FACEBOOK;}
$('a','#nav-tabs').removeClass('active');switch(which){case FEED_TYPE_FACEBOOK:if($('#wall-media-options').is(':visible')){$('#edit-media-options').slideUp(function(){$('#wall-media-options').hide();});}else{if($('#twitter-media-options').is(':visible')){$('#twitter-media-options').removeClass('active').hide();}
if($('#rss-media-options').is(':visible')){$('#rss-media-options').removeClass('active').hide();}
if($('#edit-media-options').is(':hidden')){$('#edit-media-options').addClass('active').slideDown();}
$('#wall-media-options').fadeIn('fast');$('#wall-show').addClass('active');}
break;case FEED_TYPE_TWITTER:if($('#twitter-media-options').is(':visible')){$('#edit-media-options').slideUp(function(){$('#twitter-media-options').hide();});}else{if($('#wall-media-options').is(':visible')){$('#wall-media-options').removeClass('active').hide();}
if($('#rss-media-options').is(':visible')){$('#rss-media-options').removeClass('active').hide();}
if($('#edit-media-options').is(':hidden')){$('#edit-media-options').addClass('active').slideDown();}
$('#twitter-media-options').fadeIn('fast');$('#twitter-show').addClass('active');}
break;case FEED_TYPE_RSS:if($('#rss-media-options').is(':visible')){$('#edit-media-options').slideUp(function(){$('#rss-media-options').hide();});}else{if($('#wall-media-options').is(':visible')){$('#wall-media-options').removeClass('active').hide();}
if($('#twitter-media-options').is(':visible')){$('#twitter-media-options').removeClass('active').hide();}
if($('#edit-media-options').is(':hidden')){$('#edit-media-options').addClass('active').slideDown();}
$('#rss-media-options').fadeIn('fast');$('#rss-show').addClass('active');}
break;default:break;}};return{FEED_TYPE_FACEBOOK:FEED_TYPE_FACEBOOK,FEED_TYPE_TWITTER:FEED_TYPE_TWITTER,FEED_TYPE_RSS:FEED_TYPE_RSS,close:function(){$('a','#nav-tabs').removeClass('active');if($('#wall-media-options').is(':visible')){$('#edit-media-options').slideUp(function(){$('#wall-media-options').hide();$('#twitter-media-options').hide();$('#rss-media-options').hide();});}},open:function(){showMediaPane(_current_feed);},getCurrentFeed:function(){return _current_feed;},setCurrentFeed:function(feed_type){_current_feed=feed_type;showMediaPane(feed_type);},supports:function(feed_type){return[FEED_TYPE_FACEBOOK,FEED_TYPE_TWITTER,FEED_TYPE_RSS].indexOf(feed_type)>-1;}};})();$(function(){debug('pages/editor: init.');try{if(!$.support.boxModel||!$.support.cssFloat||!$.support.opacity||!$.support.noCloneEvent){var browser_version=parseFloat($.browser.version);if($.browser.webkit){var is_chrome=/chrome/.test(navigator.userAgent.toLowerCase());if(is_chrome){debug('User needs to upgrade their Chrome browser');}else{debug('User needs to upgrade their Safari browser');}}else if($.browser.mozilla){debug('User needs to upgrade their Firefox browser');}else if($.browser.opera){debug('User needs to upgrade their Opera browser');}else if($.browser.msie){debug('User needs to upgrade to Chrome, Firefox, or equivalent');var modal_browser=new ModalUtility('#editor-pane-container',true);if(!modal_browser.hasContent()){modal_browser.showDialog($('#internet-explorer-modal').show().detach());}else{modal_browser.showDialog();}}}}catch(err){debug('Error performing feature tests on browser: '+err);}
var saveNotifier=new SaveNotifier();});$(function(){Saver.addSaveRule('tutorial-viewed','/saveAjax/saveIntroSeen/',{introType:':param'});$('#short-url-addon').bind('click',function(event){var linkDisplay=$(event.currentTarget).find('.short-url-link');if(linkDisplay&&(!$(event.target).hasClass('help')||linkDisplay.is(':hidden'))){linkDisplay.slideToggle();}});var videos={editor:'BsUVgFg9juM',css:'KZAzTTorOoc','fb-export':'Q_pcge8mWKs'};var video_player=new VideoPlayerWidget('body');var showContentTutorial=getGlobal('showContentTutorial');if(showContentTutorial){debug('VIDEO show me the content tutorial');video_player.play(videos['editor']);Saver.save('tutorial-viewed','editor');}
var level=getGlobal('level');var showAppearanceTutorial=getGlobal('showAppearanceTutorial');if(showAppearanceTutorial&&level>0){debug('VIDEO show me the visual tutorial');$('#rm-css-launch').one('click',function(e){video_player.play(videos['css']);Saver.save('tutorial-viewed','css');return false;});}
$('#open-fb-export-video').bind('click',function(e){video_player.play(videos['fb-export']);return false;});});